{
  "tipo": "package",
  "SnpPackage": [
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpPackage",
      "PackName": "PKG_LOAD_CB_RELOFI_COB_CONTA_ODS"
    }
  ],
  "SnpConnect": [
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpConnect",
      "ConName": "PRD_ODS",
      "ConnectType": "D",
      "SnpMtxt": {
        "Object": "com.sunopsis.dwg.dbobj.SnpMtxt",
        "ITxt": "2000",
        "Txt": "jdbc:oracle:thin:@172.16.24.10:1521:ODS"
      },
      "SnpMorigTxt": {
        "Object": "com.sunopsis.dwg.dbobj.SnpMorigTxt",
        "OrigineName": "MOrigTxt.Connect.JavaURL",
        "ITxtOrig": "6"
      }
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpConnect",
      "ConName": "PRD_ODI",
      "ConnectType": "D",
      "SnpMtxt": {
        "Object": "com.sunopsis.dwg.dbobj.SnpMtxt",
        "ITxt": "489000",
        "Txt": "jdbc:oracle:thin:@172.16.24.10:1521:OBI"
      }
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpConnect",
      "ConName": "SOURCE_COB_CONTA",
      "ConnectType": "D",
      "SnpMtxt": {
        "Object": "com.sunopsis.dwg.dbobj.SnpMtxt",
        "ITxt": "459000",
        "Txt": "jdbc:weblogic:sybase://10.0.0.45:2025;DatabaseName=cob_conta"
      }
    }
  ],
  "SnpLschema": [
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpLschema",
      "LschemaName": "LS_ODS"
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpLschema",
      "LschemaName": "LS_ODI"
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpLschema",
      "LschemaName": "LS_SOURCE_COB_CONTA"
    }
  ],
  "SnpTable": [
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpTable",
      "TableName": "cb_relofi",
      "ITable": "116060"
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpTable",
      "TableName": "CB_RELOFI",
      "ITable": "117060"
    }
  ],
  "SnpVar": [
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "x",
      "LschemaName": "LS_ODS",
      "VarName": "vSrcNombreTablaOds",
      "ITxtVar": "16620001",
      "ITxtVarIn": "null",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "16620001",
          "Txt": "Se define la tabla a Consultar"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "null",
      "LschemaName": "LS_ODI",
      "VarName": "vOdsSessionProccessval",
      "ITxtVar": "null",
      "ITxtVarIn": "15926001",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "15926001",
          "Txt": "select \n<%=odiRef.getPrevStepLog(\"SESS_NO\")%>\nfrom dual"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "null",
      "LschemaName": "LS_ODI",
      "VarName": "vOdsSessionLoad",
      "ITxtVar": "15932001",
      "ITxtVarIn": "15999001",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "15999001",
          "Txt": "select \n<%=odiRef.getPrevStepLog(\"SESS_NO\")%>\nfrom dual"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "01/01/1801",
      "LschemaName": "LS_ODS",
      "VarName": "vSrcFechaCarga",
      "ITxtVar": "1892001",
      "ITxtVarIn": "1699001",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "1699001",
          "Txt": "SELECT NVL(TO_CHAR(MIN(bcs.cds_date),'#SIG.vSrcFormatoFecha'), '01/01/1801')\nFROM BAN_CONFIG_ODS_DATE bcs,\n        BAN_CONFIG_ODS o\nWHERE bcs.cds_source =  '#SIG.vSrcNombreTablaOds'\nAND bcs.cds_status_carga =  'POR PROCESAR'\n AND O.COO_SOURCE = BCS.cds_source\n  and  bcs.cds_date BETWEEN o.coo_start_date and o.coo_end_date"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "MM/DD/YYYY",
      "LschemaName": "LS_ODS",
      "VarName": "vSrcFormatoFecha",
      "ITxtVar": "17334001",
      "ITxtVarIn": "8669060",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "8669060",
          "Txt": "SELECT 'MM/DD/YYYY' FROM DUAL"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "null",
      "LschemaName": "null",
      "VarName": "vSrcCargaStatus",
      "ITxtVar": "16621001",
      "ITxtVarIn": "null",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "16621001",
          "Txt": "Definir el Status del proceso"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "null",
      "LschemaName": "LS_ODS",
      "VarName": "vOdsCountHist",
      "ITxtVar": "null",
      "ITxtVarIn": "9872060",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "9872060",
          "Txt": "SELECT COUNT(1)\nFROM #vSrcNombreTablaOds\nWHERE #vSrcFecha"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "null",
      "LschemaName": "LS_ODS",
      "VarName": "vSrcFecha",
      "ITxtVar": "null",
      "ITxtVarIn": "11795060",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "11795060",
          "Txt": "SELECT\n  CASE \n    WHEN Campo = 'NADA' THEN\n        ' 1=1'\n    WHEN Campo = 'FechaCarga' THEN\n          Campo ||   '='  || 'TO_CHAR(TO_DATE(' ||  ''''  ||  '#vSrcFechaCarga'   ||  '''' ||  ' ,'  ||  '''' ||   '#vSrcFormatoFecha'  || ''''  || ' ),'  || ''''  ||  'DDMM'  ||  ''''  || ')' \n    ELSE\n           Campo ||   '='  || 'TO_DATE(' ||  ''''  ||  '#vSrcFechaCarga'   ||  '''' ||  ' ,'  ||  '''' ||   '#vSrcFormatoFecha'  || ''''  || ' )' \n   END\nFROM (\nSELECT NVL(MAX(PARTITION_COL), 'NADA') Campo\nFROM BAN_CONFIG_MTTO_TABLAS_ODS O\nWHERE O.TABLE_NAME = '#vSrcNombreTablaOds'\n AND PARTITION_COL IS NOT NULL \n AND PARTITION_COL != 'N/A'\n)"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpVar",
      "DefV": "null",
      "LschemaName": "null",
      "VarName": "vSrcMostrarError",
      "ITxtVar": "768060",
      "ITxtVarIn": "769060",
      "SnpTxtHeader": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpTxtHeader",
          "ITxt": "769060",
          "Txt": "Select Error from Dual"
        }
      ]
    }
  ],
  "SnpPop": [
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpPop",
      "LschemaName": "LS_ODS",
      "PopName": "IT_CB_RELOFI_COB_CONTA_ODS",
      "TableName (Target Table)": "CB_RELOFI"
    }
  ],
  "SnpScenStep": [
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "vSrcNombreTablaOds",
      "StepType": "VD",
      "Nno": "0",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "0",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "null",
          "TaskName3": "null",
          "OrdTrt": "null",
          "SnpVar": [
            {
              "Object": "com.sunopsis.dwg.dbobj.SnpVar",
              "VarName": "vSrcNombreTablaOds",
              "DefV": "x"
            }
          ]
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "vOdsSessionProccessval",
      "StepType": "VD",
      "Nno": "1",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "1",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "null",
          "TaskName3": "null",
          "OrdTrt": "null",
          "SnpVar": [
            {
              "Object": "com.sunopsis.dwg.dbobj.SnpVar",
              "VarName": "vOdsSessionProccessval",
              "DefV": "null"
            }
          ]
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "vOdsSessionLoad",
      "StepType": "V",
      "Nno": "2",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "2",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "select \n<?=snpRef.getPrevStepLog(\"SESS_NO\") ?>\nfrom dual",
          "TaskName3": "null",
          "OrdTrt": "null",
          "SnpVar": [
            {
              "Object": "com.sunopsis.dwg.dbobj.SnpVar",
              "VarName": "vOdsSessionLoad",
              "DefV": "null"
            }
          ]
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "vSrcFechaCarga",
      "StepType": "VD",
      "Nno": "3",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "3",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "null",
          "TaskName3": "null",
          "OrdTrt": "null",
          "SnpVar": [
            {
              "Object": "com.sunopsis.dwg.dbobj.SnpVar",
              "VarName": "vSrcFechaCarga",
              "DefV": "01/01/1801"
            }
          ]
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "IT_CB_RELOFI_COB_CONTA_ODS",
      "StepType": "F",
      "Nno": "4",
      "TableName (Target Table)": "CB_RELOFI",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Loading",
          "ColTxt": "null",
          "DefTxt": "drop table <?=snpRef.getObjectName(\"L\", \"%COL_PRF0CB_RELOFI\", \"W\") ?> purge",
          "TaskName3": "Drop work table",
          "OrdTrt": "20"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Loading",
          "ColTxt": "null",
          "DefTxt": "create table <?=snpRef.getObjectName(\"L\", \"%COL_PRF0CB_RELOFI\", \"W\") ?>\n(\n\tC1_RE_FILIAL\tNUMBER(3) NULL,\n\tC2_RE_EMPRESA\tNUMBER(3) NULL,\n\tC3_RE_OFADMIN\tNUMBER(5) NULL,\n\tC4_RE_OFCONTA\tNUMBER(8) NULL\n)\nNOLOGGING",
          "TaskName3": "Create work table",
          "OrdTrt": "30"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Loading",
          "ColTxt": "select\t\n\tCB_RELOFI.re_filial\t   C1_RE_FILIAL,\n\tCB_RELOFI.re_empresa\t   C2_RE_EMPRESA,\n\tCB_RELOFI.re_ofadmin\t   C3_RE_OFADMIN,\n\tCB_RELOFI.re_ofconta\t   C4_RE_OFCONTA\nfrom\t<?=snpRef.getObjectName(\"L\", \"cb_relofi\", \"SOURCE_COB_CONTA\", \"\", \"D\")?>   CB_RELOFI\nwhere\t(1=1)\nAnd (CB_RELOFI.re_empresa = 1)",
          "DefTxt": "insert /*+ append */ into <?=snpRef.getObjectName(\"L\", \"%COL_PRF0CB_RELOFI\", \"W\") ?>\n(\n\tC1_RE_FILIAL,\n\tC2_RE_EMPRESA,\n\tC3_RE_OFADMIN,\n\tC4_RE_OFCONTA\n)\nvalues\n(\n\t%s,\n\t%s,\n\t%s,\n\t%s\n)",
          "TaskName3": "Load data",
          "OrdTrt": "50"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Loading",
          "ColTxt": "null",
          "DefTxt": "BEGIN\nDBMS_STATS.GATHER_TABLE_STATS (\n    ownname =>\t'<?=snpRef.getInfo(\"DEST_WORK_SCHEMA\") ?>',\n    tabname =>\t'<?=snpRef.getObjectName(\"L\", \"%COL_PRF0CB_RELOFI\", \"W\").replaceAll(odiRef.getInfo( \"DEST_WORK_SCHEMA\" )+\".\",\"\")?>',\n    estimate_percent =>\tDBMS_STATS.AUTO_SAMPLE_SIZE\n);\nEND;",
          "TaskName3": "Analyze work table",
          "OrdTrt": "70"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Integration",
          "ColTxt": "null",
          "DefTxt": "truncate table <?=snpRef.getObjectName(\"L\", \"CB_RELOFI\", \"ODS\", \"\", \"D\") ?>",
          "TaskName3": "Truncate target table",
          "OrdTrt": "80"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Loading",
          "ColTxt": "null",
          "DefTxt": "drop table <?=snpRef.getObjectName(\"L\", \"%COL_PRF0CB_RELOFI\", \"W\") ?> purge",
          "TaskName3": "Drop work table",
          "OrdTrt": "90"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Integration",
          "ColTxt": "null",
          "DefTxt": "insert into\t<?=snpRef.getObjectName(\"L\", \"CB_RELOFI\", \"ODS\", \"\", \"D\") ?> \n( \n\tRE_FILIAL,\n\tRE_EMPRESA,\n\tRE_OFADMIN,\n\tRE_OFCONTA \n\t \n) \n\nselect\n    RE_FILIAL,\n\tRE_EMPRESA,\n\tRE_OFADMIN,\n\tRE_OFCONTA   \n   \nFROM (\t\n\n\nselect \t\n\tC1_RE_FILIAL RE_FILIAL,\n\tC2_RE_EMPRESA RE_EMPRESA,\n\tC3_RE_OFADMIN RE_OFADMIN,\n\tC4_RE_OFCONTA RE_OFCONTA \nfrom\t<?=snpRef.getObjectName(\"L\", \"%COL_PRF0CB_RELOFI\", \"ODS\", \"W\")?>\nwhere\t\t(1=1)\t\n\n\n\n\n\n\n)    ODI_GET_FROM",
          "TaskName3": "Insert new rows",
          "OrdTrt": "100"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Integration",
          "ColTxt": "null",
          "DefTxt": "/* commit */",
          "TaskName3": "Commit transaction",
          "OrdTrt": "110"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Integration",
          "ColTxt": "null",
          "DefTxt": "DECLARE\n\n\nBEGIN\n\n  PR_ACTUALIZA_ESTADISTICAS('<?=snpRef.getInfo(\"DEST_SCHEMA\") ?>',  '<?=snpRef.getObjectName(\"L\", \"CB_RELOFI\", \"ODS\", \"\", \"D\") ?>', null, TO_DATE('{vSrcFechaCarga}', '{vSrcFormatoFecha}'));\n\nEND;",
          "TaskName3": "Execute Stats",
          "OrdTrt": "150"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "4",
          "TaskName1": "Integration",
          "ColTxt": "null",
          "DefTxt": "<? String vSess = odiRef.getSession(\"SESS_NO\"); ?>\n<$import Java.lang.*;$>",
          "TaskName3": "Declarar variable sesion paralelismo",
          "OrdTrt": "170"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "vSrcCargaStatus",
      "StepType": "VS",
      "Nno": "5",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "5",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "null",
          "TaskName3": "null",
          "OrdTrt": "null",
          "SnpVar": [
            {
              "Object": "com.sunopsis.dwg.dbobj.SnpVar",
              "VarName": "vSrcCargaStatus",
              "DefV": "null"
            }
          ]
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "PROC_UPD_STATUS_CARGA_ODS",
      "StepType": "T",
      "Nno": "6",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "6",
          "TaskName1": "Procedure",
          "ColTxt": "null",
          "DefTxt": "UPDATE BAN_CONFIG_ODS_DATE\nSET cds_status_carga = '{vSrcCargaStatus}', \n       cds_num_rows = NVL({vOdsCountHist}, -1),\n       cds_last_upd_date = sysdate\nWHERE cds_source = '{vSrcNombreTablaOds}'\nand cds_date = TO_DATE( '{vSrcFechaCarga}', '{vSrcFormatoFecha}')",
          "TaskName3": "UPD BAN_CONF_ODS_DATE Status Carga",
          "OrdTrt": "0"
        },
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "6",
          "TaskName1": "Procedure",
          "ColTxt": "null",
          "DefTxt": "UPDATE BAN_CONFIG_ODS\n         SET coo_last_date_sucess = TO_DATE('{vSrcFechaCarga}', '{vSrcFormatoFecha}')\n    WHERE coo_source = '{vSrcNombreTablaOds}'\n      AND  '{vSrcCargaStatus}' = 'PROCESADO'",
          "TaskName3": "UPD BAN_CONF_ODS Last Date Sucess",
          "OrdTrt": "10"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "Valida CargaStatus",
      "StepType": "VE",
      "Nno": "7",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "7",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "null",
          "TaskName3": "null",
          "OrdTrt": "null"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "Error - PKG_LOAD_CB_RELOFI_COB_CONTA_ODS",
      "StepType": "V",
      "Nno": "8",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "8",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "Select Error from Dual",
          "TaskName3": "null",
          "OrdTrt": "null"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "CargaStatus = Error",
      "StepType": "VS",
      "Nno": "9",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "9",
          "TaskName1": "Variable",
          "ColTxt": "null",
          "DefTxt": "null",
          "TaskName3": "null",
          "OrdTrt": "null"
        }
      ]
    },
    {
      "Object": "com.sunopsis.dwg.dbobj.SnpScenStep",
      "StepName": "PKG_REGISTRAR_LOG_ODS",
      "StepType": "SE",
      "Nno": "10",
      "TableName (Target Table)": "null",
      "SnpScenTask": [
        {
          "Object": "com.sunopsis.dwg.dbobj.SnpScenTask",
          "Nno": "10",
          "TaskName1": "Oracle Data Integrator Command",
          "ColTxt": "null",
          "DefTxt": "OdiStartScen \"-SCEN_NAME=PKG_REGISTRAR_LOG_ODS\" \"-SCEN_VERSION=001\" \"-SESSION_NAME=<?=snpRef.getSession(\"SESS_NO\") ?> PKG_REGISTRAR_LOG_ODS\" \"-SIG.vOdsSessionProccessval={vOdsSessionProccessval}\" \"-SIG.vSrcCargaStatus={vSrcCargaStatus}\" \"-SIG.vSrcNombreTablaOds={vSrcNombreTablaOds}\" \"-SIG.vSrcFechaCarga={vSrcFechaCarga}\" \"-SIG.vOdsSessionLoad={vOdsSessionLoad}\"",
          "TaskName3": "null",
          "OrdTrt": "null"
        }
      ]
    }
  ]
}